var partial = '<%= escape_javascript(render partial: 'shared/posts', :locals => { topic: @topic, posts: @posts }) %>';
var path = '<%="#{topic_path page: @posts.next_page }".html_safe %>';

$('a.load-more-posts').before(partial);
$('a.load-more-posts').attr('href', path);
 
<% unless @posts.next_page %>
  $('a.load-more-posts').remove();
<% end %>